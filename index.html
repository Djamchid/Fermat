<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Qu√™te du Th√©or√®me de Fermat</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
        }

        .book-container {
            background: #f8f8f8;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin: 10px 0;
            width: 100%;
        }

        .chapter-header {
            text-align: center;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .chapter-header h1 {
            font-size: 1.5rem;
            margin: 0;
            line-height: 1.3;
        }

        .story-text {
            line-height: 1.7;
            font-size: 1rem;
            margin-bottom: 20px;
            text-align: justify;
            hyphens: auto;
        }

        .choices {
            display: grid;
            gap: 12px;
            margin-top: 20px;
        }

        .choice-button {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-align: left;
            line-height: 1.4;
            min-height: 60px;
            display: flex;
            align-items: center;
        }

        .choice-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .choice-button:active {
            transform: translateY(0);
        }

        .math-formula {
            background: #ecf0f1;
            padding: 15px;
            border-left: 4px solid #3498db;
            margin: 15px 0;
            font-family: 'Times New Roman', serif;
            font-style: italic;
            text-align: center;
            font-size: 1rem;
            overflow-x: auto;
            white-space: nowrap;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .ending {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .ending h2 {
            margin-top: 0;
            font-size: 1.5rem;
        }

        .success {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .failure {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .restart-button {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 15px;
            transition: background 0.3s ease;
        }

        .restart-button:hover {
            background: #27ae60;
        }

        .year {
            font-size: 0.8rem;
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 15px;
            font-style: italic;
        }

        /* Tablettes */
        @media (max-width: 768px) {
            body {
                padding: 8px;
            }

            .book-container {
                padding: 15px;
                border-radius: 10px;
                margin: 8px 0;
            }

            .chapter-header h1 {
                font-size: 1.3rem;
            }

            .story-text {
                font-size: 0.95rem;
                text-align: left;
            }

            .choice-button {
                padding: 12px;
                font-size: 0.85rem;
                min-height: 55px;
            }

            .math-formula {
                padding: 12px;
                font-size: 0.9rem;
            }
        }

        /* Smartphones */
        @media (max-width: 480px) {
            body {
                padding: 5px;
                font-size: 14px;
            }

            .book-container {
                padding: 12px;
                border-radius: 8px;
                margin: 5px 0;
            }

            .chapter-header {
                padding-bottom: 10px;
                margin-bottom: 15px;
            }

            .chapter-header h1 {
                font-size: 1.2rem;
                line-height: 1.2;
            }

            .story-text {
                font-size: 0.9rem;
                line-height: 1.6;
                margin-bottom: 15px;
                text-align: left;
            }

            .choices {
                gap: 10px;
                margin-top: 15px;
            }

            .choice-button {
                padding: 10px;
                font-size: 0.8rem;
                min-height: 50px;
                border-radius: 6px;
            }

            .choice-button:hover {
                transform: none; /* D√©sactiver les animations sur mobile */
            }

            .math-formula {
                padding: 10px;
                font-size: 0.85rem;
                margin: 10px 0;
                border-left-width: 3px;
            }

            .progress-bar {
                height: 6px;
                margin: 10px 0;
            }

            .ending {
                padding: 15px;
                margin: 15px 0;
            }

            .ending h2 {
                font-size: 1.3rem;
            }

            .restart-button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .year {
                font-size: 0.75rem;
            }
        }

        /* Tr√®s petits √©crans */
        @media (max-width: 320px) {
            .chapter-header h1 {
                font-size: 1.1rem;
            }

            .story-text {
                font-size: 0.85rem;
            }

            .choice-button {
                font-size: 0.75rem;
                padding: 8px;
                min-height: 45px;
            }

            .math-formula {
                font-size: 0.8rem;
                padding: 8px;
            }
        }

        /* Mode paysage sur mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .book-container {
                padding: 10px;
            }

            .chapter-header {
                margin-bottom: 10px;
            }

            .story-text {
                margin-bottom: 10px;
            }

            .choices {
                gap: 8px;
                margin-top: 10px;
            }

            .choice-button {
                min-height: 40px;
                padding: 8px;
            }
        }

        /* Am√©lioration de l'accessibilit√© */
        @media (prefers-reduced-motion: reduce) {
            .choice-button {
                transition: none;
            }

            .choice-button:hover {
                transform: none;
            }

            .progress-fill {
                transition: none;
            }
        }

        /* Mode sombre syst√®me */
        @media (prefers-color-scheme: dark) {
            .book-container {
                background: #2c3e50;
                color: #ecf0f1;
            }

            .chapter-header {
                color: #3498db;
            }

            .math-formula {
                background: #34495e;
                color: #ecf0f1;
            }
        }
    </style>
</head>
<body>
    <div class="book-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progress" style="width: 0%"></div>
        </div>
        
        <div id="story-content">
            <!-- Le contenu sera g√©n√©r√© par JavaScript -->
        </div>
    </div>

    <script>
        const story = {
            start: {
                title: "Prologue : Le D√©fi de Fermat",
                year: "1637 - Toulouse, France",
                text: `Vous √™tes Pierre de Fermat, magistrat et math√©maticien amateur. En lisant l'Arithm√©tique de Diophante, vous venez de d√©couvrir une propri√©t√© fascinante des nombres. Dans la marge de votre livre, vous griffonnez une note qui hantera les math√©maticiens pendant plus de 350 ans.`,
                formula: "x<sup>n</sup> + y<sup>n</sup> = z<sup>n</sup> n'a pas de solutions enti√®res pour n > 2",
                choices: [
                    { text: "A. Vous √©crivez : 'J'ai d√©couvert une d√©monstration merveilleuse, mais cette marge est trop √©troite pour la contenir'", next: "fermat_claim" },
                    { text: "B. Vous tentez imm√©diatement de d√©montrer le th√©or√®me par la m√©thode de descente infinie", next: "dead_end_1" },
                    { text: "C. Vous cherchez des contre-exemples pour v√©rifier votre intuition", next: "dead_end_1" },
                    { text: "D. Vous abandonnez, pensant que c'est trop difficile", next: "dead_end_1" }
                ],
                progress: 10
            },

            fermat_claim: {
                title: "Chapitre 1 : L'H√©ritage d'un Myst√®re",
                year: "1995 - Princeton, √âtats-Unis",
                text: `Vous √™tes maintenant Andrew Wiles, math√©maticien √† Princeton. Depuis votre enfance, vous √™tes obs√©d√© par le dernier th√©or√®me de Fermat. Apr√®s des si√®cles d'√©checs, vous d√©cidez de vous attaquer au probl√®me. Mais par o√π commencer ? La m√©thode directe a √©chou√© pendant 350 ans.`,
                formula: "Il faut une approche r√©volutionnaire...",
                choices: [
                    { text: "A. √âtudier la conjecture de Shimura-Taniyama-Weil sur les courbes elliptiques", next: "shimura_taniyama" },
                    { text: "B. Utiliser la th√©orie des nombres alg√©briques de Kummer", next: "dead_end_2" },
                    { text: "C. Appliquer les m√©thodes de g√©om√©trie alg√©brique de Grothendieck", next: "dead_end_2" },
                    { text: "D. Chercher une preuve √©l√©mentaire avec les m√©thodes du 17√®me si√®cle", next: "dead_end_2" }
                ],
                progress: 25
            },

            shimura_taniyama: {
                title: "Chapitre 2 : La Conjecture R√©volutionnaire",
                year: "1986 - Berkeley",
                text: `Brillant ! Vous vous souvenez de la conf√©rence de Ken Ribet qui a montr√© que la conjecture de Shimura-Taniyama-Weil implique le th√©or√®me de Fermat. Cette conjecture affirme que toute courbe elliptique rationnelle est modulaire. Si vous pouvez prouver cette conjecture, Fermat tombera !`,
                formula: "Courbe elliptique ‚Üî Forme modulaire",
                choices: [
                    { text: "A. Utiliser la th√©orie des repr√©sentations galoisiennes pour lier courbes elliptiques et formes modulaires", next: "galois_representations" },
                    { text: "B. Appliquer directement les s√©ries L et les fonctions z√™ta", next: "dead_end_3" },
                    { text: "C. Utiliser les m√©thodes de cohomologie √©tale", next: "dead_end_3" },
                    { text: "D. √âtudier les jacobiennes des courbes modulaires", next: "dead_end_3" }
                ],
                progress: 40
            },

            galois_representations: {
                title: "Chapitre 3 : Les Repr√©sentations Galoisiennes",
                year: "1991 - Princeton",
                text: `Vous travaillez maintenant en secret depuis 7 ans. Les repr√©sentations galoisiennes sont la cl√© ! Elles permettent de traduire les propri√©t√©s arithm√©tiques des courbes elliptiques en propri√©t√©s des formes modulaires. Mais il faut encore franchir un obstacle majeur...`,
                formula: "œÅ : Gal(QÃÑ/Q) ‚Üí GL‚ÇÇ(Z_p)",
                choices: [
                    { text: "A. D√©velopper une m√©thode pour relever les repr√©sentations modulaires en caract√©ristique p", next: "deformation_theory" },
                    { text: "B. Utiliser les courbes de Shimura pour construire les repr√©sentations", next: "dead_end_4" },
                    { text: "C. Appliquer la th√©orie de Langlands directement", next: "dead_end_4" },
                    { text: "D. Chercher des isog√©nies entre courbes elliptiques", next: "dead_end_4" }
                ],
                progress: 55
            },

            deformation_theory: {
                title: "Chapitre 4 : La Th√©orie des D√©formations",
                year: "1993 - Princeton",
                text: `G√©nial ! Vous d√©veloppez une th√©orie des d√©formations des repr√©sentations galoisiennes. Cela permet de 'relever' les repr√©sentations de caract√©ristique p vers la caract√©ristique 0. Mais votre premi√®re tentative a une faille...`,
                formula: "R ‚Üí T (anneau universel de d√©formation)",
                choices: [
                    { text: "A. Collaborer avec Richard Taylor pour combler la lacune avec la th√©orie d'Iwasawa", next: "taylor_collaboration" },
                    { text: "B. Chercher une approche diff√©rente via les courbes de Fermat g√©n√©ralis√©es", next: "dead_end_5" },
                    { text: "C. Utiliser les m√©thodes de Kolyvagin et les hauteurs d'Arakelov", next: "dead_end_5" },
                    { text: "D. Abandonner et essayer une approche compl√®tement diff√©rente", next: "dead_end_5" }
                ],
                progress: 70
            },

            taylor_collaboration: {
                title: "Chapitre 5 : La Collaboration D√©cisive",
                year: "1994-1995 - Princeton",
                text: `Avec Richard Taylor, vous d√©veloppez de nouveaux outils pour traiter les cas r√©siduels. En utilisant la th√©orie d'Iwasawa et une construction ing√©nieuse impliquant les courbes de Hecke, vous parvenez enfin √† compl√©ter la preuve !`,
                formula: "‚àÄn>2, x^n + y^n ‚â† z^n (x,y,z ‚àà ‚Ñï*)",
                choices: [
                    { text: "A. Annoncer la preuve compl√®te du th√©or√®me de Fermat au monde math√©matique", next: "victory" },
                    { text: "B. Garder la preuve secr√®te pour la v√©rifier encore", next: "dead_end_6" },
                    { text: "C. Publier seulement la partie sur Shimura-Taniyama", next: "dead_end_6" },
                    { text: "D. Demander √† d'autres de v√©rifier d'abord", next: "dead_end_6" }
                ],
                progress: 85
            },

            victory: {
                title: "√âpilogue : La Gloire √âternelle",
                year: "1995 - Cambridge, Angleterre",
                text: `F√©licitations ! Vous avez r√©ussi √† suivre le chemin exact qu'Andrew Wiles a emprunt√© pour prouver le dernier th√©or√®me de Fermat. Votre preuve de 109 pages, utilisant les math√©matiques les plus avanc√©es du 20√®me si√®cle, r√©sout enfin le myst√®re vieux de 358 ans.<br><br>
                Le 23 juin 1993, lors d'une conf√©rence √† Cambridge, vous avez conclu votre pr√©sentation par ces mots historiques : "Je pense que je vais m'arr√™ter ici" avant de r√©v√©ler la solution au monde √©bahi.<br><br>
                Vous √™tes devenu une l√©gende vivante des math√©matiques !`,
                formula: "Q.E.D. - Ce qu'il fallait d√©montrer",
                ending: "success",
                progress: 100
            },

            // Dead ends
            dead_end_1: {
                title: "Impasse : L'Approche Na√Øve",
                text: `H√©las ! Comme tant d'autres avant vous, vous vous heurtez √† la complexit√© insurmontable du probl√®me avec les m√©thodes √©l√©mentaires. Le th√©or√®me de Fermat r√©sistera encore pendant des si√®cles √† cette approche directe.`,
                ending: "failure",
                progress: 15
            },

            dead_end_2: {
                title: "Impasse : Les M√©thodes Classiques",
                text: `Bien que ces approches soient sophistiqu√©es, elles ne suffisent pas pour Fermat. Il faudra attendre les d√©veloppements r√©volutionnaires de la fin du 20√®me si√®cle pour trouver la voie.`,
                ending: "failure",
                progress: 30
            },

            dead_end_3: {
                title: "Impasse : L'Outil Inad√©quat",
                text: `Ces m√©thodes, bien qu'importantes en th√©orie des nombres, ne peuvent pas √©tablir le lien crucial entre courbes elliptiques et formes modulaires n√©cessaire pour Fermat.`,
                ending: "failure",
                progress: 45
            },

            dead_end_4: {
                title: "Impasse : La Voie Bloqu√©e",
                text: `Vous √™tes sur la bonne piste avec les repr√©sentations galoisiennes, mais cette approche particuli√®re ne permet pas de construire le pont n√©cessaire vers les formes modulaires.`,
                ending: "failure",
                progress: 60
            },

            dead_end_5: {
                title: "Impasse : Si Proche du But",
                text: `Vous √©tiez tr√®s proche ! Mais sans la th√©orie des d√©formations ad√©quate et la collaboration avec Taylor, la lacune dans votre preuve demeure b√©ante.`,
                ending: "failure",
                progress: 75
            },

            dead_end_6: {
                title: "Impasse : L'Occasion Manqu√©e",
                text: `Ironie du sort ! Vous aviez la preuve compl√®te, mais en ne l'annon√ßant pas au bon moment, l'histoire vous a oubli√©s. Il faut savoir saisir sa chance dans la science !`,
                ending: "failure",
                progress: 90
            }
        };

        let currentNode = 'start';

        // Fonction pour m√©langer un tableau
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function displayNode(nodeId) {
            const node = story[nodeId];
            const content = document.getElementById('story-content');
            const progress = document.getElementById('progress');
            
            progress.style.width = node.progress + '%';
            
            if (node.ending) {
                // Fin du jeu
                content.innerHTML = `
                    <div class="chapter-header">
                        <h1>${node.title}</h1>
                        ${node.year ? `<div class="year">${node.year}</div>` : ''}
                    </div>
                    <div class="story-text">${node.text}</div>
                    ${node.formula ? `<div class="math-formula">${node.formula}</div>` : ''}
                    <div class="ending ${node.ending}">
                        <h2>${node.ending === 'success' ? 'üéâ VICTOIRE ! üéâ' : 'üí• √âCHEC üí•'}</h2>
                        <p>${node.ending === 'success' ? 'Vous avez r√©ussi √† reconstituer la preuve historique !' : 'Ce chemin ne m√®ne pas √† la solution...'}</p>
                        <button class="restart-button" onclick="restart()">Recommencer l'aventure</button>
                    </div>
                `;
            } else {
                // M√©langer les choix al√©atoirement
                const shuffledChoices = shuffleArray(node.choices);
                const letters = ['A', 'B', 'C', 'D'];
                
                // N≈ìud normal avec choix
                content.innerHTML = `
                    <div class="chapter-header">
                        <h1>${node.title}</h1>
                        ${node.year ? `<div class="year">${node.year}</div>` : ''}
                    </div>
                    <div class="story-text">${node.text}</div>
                    ${node.formula ? `<div class="math-formula">${node.formula}</div>` : ''}
                    <div class="choices">
                        ${shuffledChoices.map((choice, index) => {
                            // Remplacer la lettre originale par la nouvelle position
                            const newText = choice.text.replace(/^[A-D]\./, `${letters[index]}.`);
                            return `<button class="choice-button" onclick="makeChoice('${choice.next}')">${newText}</button>`;
                        }).join('')}
                    </div>
                `;
            }
        }

        function makeChoice(nextNode) {
            currentNode = nextNode;
            displayNode(currentNode);
        }

        function restart() {
            currentNode = 'start';
            displayNode(currentNode);
        }

        // Initialiser le jeu
        displayNode(currentNode);
    </script>
</body>
</html>
