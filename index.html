<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Quête du Théorème de Fermat</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
        }

        .book-container {
            background: #f8f8f8;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin: 10px 0;
            width: 100%;
        }

        .chapter-header {
            text-align: center;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .chapter-header h1 {
            font-size: 1.5rem;
            margin: 0;
            line-height: 1.3;
        }

        .story-text {
            line-height: 1.7;
            font-size: 1rem;
            margin-bottom: 20px;
            text-align: justify;
            hyphens: auto;
        }

        .choices {
            display: grid;
            gap: 12px;
            margin-top: 20px;
        }

        .choice-button {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-align: left;
            line-height: 1.4;
            min-height: 60px;
            display: flex;
            align-items: center;
        }

        .choice-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .choice-button:active {
            transform: translateY(0);
        }

        .math-formula {
            background: #ecf0f1;
            padding: 15px;
            border-left: 4px solid #3498db;
            margin: 15px 0;
            font-family: 'Times New Roman', serif;
            font-style: italic;
            text-align: center;
            font-size: 1rem;
            overflow-x: auto;
            white-space: nowrap;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .ending {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .ending h2 {
            margin-top: 0;
            font-size: 1.5rem;
        }

        .success {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .failure {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .restart-button {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 15px;
            transition: background 0.3s ease;
        }

        .restart-button:hover {
            background: #27ae60;
        }

        .year {
            font-size: 0.8rem;
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 15px;
            font-style: italic;
        }

        /* Tablettes */
        @media (max-width: 768px) {
            body {
                padding: 8px;
            }

            .book-container {
                padding: 15px;
                border-radius: 10px;
                margin: 8px 0;
            }

            .chapter-header h1 {
                font-size: 1.3rem;
            }

            .story-text {
                font-size: 0.95rem;
                text-align: left;
            }

            .choice-button {
                padding: 12px;
                font-size: 0.85rem;
                min-height: 55px;
            }

            .math-formula {
                padding: 12px;
                font-size: 0.9rem;
            }
        }

        /* Smartphones */
        @media (max-width: 480px) {
            body {
                padding: 5px;
                font-size: 14px;
            }

            .book-container {
                padding: 12px;
                border-radius: 8px;
                margin: 5px 0;
            }

            .chapter-header {
                padding-bottom: 10px;
                margin-bottom: 15px;
            }

            .chapter-header h1 {
                font-size: 1.2rem;
                line-height: 1.2;
            }

            .story-text {
                font-size: 0.9rem;
                line-height: 1.6;
                margin-bottom: 15px;
                text-align: left;
            }

            .choices {
                gap: 10px;
                margin-top: 15px;
            }

            .choice-button {
                padding: 10px;
                font-size: 0.8rem;
                min-height: 50px;
                border-radius: 6px;
            }

            .choice-button:hover {
                transform: none; /* Désactiver les animations sur mobile */
            }

            .math-formula {
                padding: 10px;
                font-size: 0.85rem;
                margin: 10px 0;
                border-left-width: 3px;
            }

            .progress-bar {
                height: 6px;
                margin: 10px 0;
            }

            .ending {
                padding: 15px;
                margin: 15px 0;
            }

            .ending h2 {
                font-size: 1.3rem;
            }

            .restart-button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .year {
                font-size: 0.75rem;
            }
        }

        /* Très petits écrans */
        @media (max-width: 320px) {
            .chapter-header h1 {
                font-size: 1.1rem;
            }

            .story-text {
                font-size: 0.85rem;
            }

            .choice-button {
                font-size: 0.75rem;
                padding: 8px;
                min-height: 45px;
            }

            .math-formula {
                font-size: 0.8rem;
                padding: 8px;
            }
        }

        /* Mode paysage sur mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .book-container {
                padding: 10px;
            }

            .chapter-header {
                margin-bottom: 10px;
            }

            .story-text {
                margin-bottom: 10px;
            }

            .choices {
                gap: 8px;
                margin-top: 10px;
            }

            .choice-button {
                min-height: 40px;
                padding: 8px;
            }
        }

        /* Amélioration de l'accessibilité */
        @media (prefers-reduced-motion: reduce) {
            .choice-button {
                transition: none;
            }

            .choice-button:hover {
                transform: none;
            }

            .progress-fill {
                transition: none;
            }
        }

        /* Mode sombre système */
        @media (prefers-color-scheme: dark) {
            .book-container {
                background: #2c3e50;
                color: #ecf0f1;
            }

            .chapter-header {
                color: #3498db;
            }

            .math-formula {
                background: #34495e;
                color: #ecf0f1;
            }
        }
    </style>
</head>
<body>
    <div class="book-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progress" style="width: 0%"></div>
        </div>
        
        <div id="story-content">
            <!-- Le contenu sera généré par JavaScript -->
        </div>
    </div>

    <script>
        const story = {
            start: {
                title: "Prologue : Le Défi de Fermat",
                year: "1637 - Toulouse, France",
                text: `Vous êtes Pierre de Fermat, magistrat et mathématicien amateur. En lisant l'Arithmétique de Diophante, vous venez de découvrir une propriété fascinante des nombres. Dans la marge de votre livre, vous griffonnez une note qui hantera les mathématiciens pendant plus de 350 ans.`,
                formula: "x<sup>n</sup> + y<sup>n</sup> = z<sup>n</sup> n'a pas de solutions entières pour n > 2",
                choices: [
                    { text: "A. Vous écrivez : 'J'ai découvert une démonstration merveilleuse, mais cette marge est trop étroite pour la contenir'", next: "fermat_claim" },
                    { text: "B. Vous tentez immédiatement de démontrer le théorème par la méthode de descente infinie", next: "dead_end_1" },
                    { text: "C. Vous cherchez des contre-exemples pour vérifier votre intuition", next: "dead_end_1" },
                    { text: "D. Vous abandonnez, pensant que c'est trop difficile", next: "dead_end_1" }
                ],
                progress: 10
            },

            fermat_claim: {
                title: "Chapitre 1 : L'Héritage d'un Mystère",
                year: "1995 - Princeton, États-Unis",
                text: `Vous êtes maintenant Andrew Wiles, mathématicien à Princeton. Depuis votre enfance, vous êtes obsédé par le dernier théorème de Fermat. Après des siècles d'échecs, vous décidez de vous attaquer au problème. Mais par où commencer ? La méthode directe a échoué pendant 350 ans.`,
                formula: "Il faut une approche révolutionnaire...",
                choices: [
                    { text: "A. Étudier la conjecture de Shimura-Taniyama-Weil sur les courbes elliptiques", next: "shimura_taniyama" },
                    { text: "B. Utiliser la théorie des nombres algébriques de Kummer", next: "dead_end_2" },
                    { text: "C. Appliquer les méthodes de géométrie algébrique de Grothendieck", next: "dead_end_2" },
                    { text: "D. Chercher une preuve élémentaire avec les méthodes du 17ème siècle", next: "dead_end_2" }
                ],
                progress: 25
            },

            shimura_taniyama: {
                title: "Chapitre 2 : La Conjecture Révolutionnaire",
                year: "1986 - Berkeley",
                text: `Brillant ! Vous vous souvenez de la conférence de Ken Ribet qui a montré que la conjecture de Shimura-Taniyama-Weil implique le théorème de Fermat. Cette conjecture affirme que toute courbe elliptique rationnelle est modulaire. Si vous pouvez prouver cette conjecture, Fermat tombera !`,
                formula: "Courbe elliptique ↔ Forme modulaire",
                choices: [
                    { text: "A. Utiliser la théorie des représentations galoisiennes pour lier courbes elliptiques et formes modulaires", next: "galois_representations" },
                    { text: "B. Appliquer directement les séries L et les fonctions zêta", next: "dead_end_3" },
                    { text: "C. Utiliser les méthodes de cohomologie étale", next: "dead_end_3" },
                    { text: "D. Étudier les jacobiennes des courbes modulaires", next: "dead_end_3" }
                ],
                progress: 40
            },

            galois_representations: {
                title: "Chapitre 3 : Les Représentations Galoisiennes",
                year: "1991 - Princeton",
                text: `Vous travaillez maintenant en secret depuis 7 ans. Les représentations galoisiennes sont la clé ! Elles permettent de traduire les propriétés arithmétiques des courbes elliptiques en propriétés des formes modulaires. Mais il faut encore franchir un obstacle majeur...`,
                formula: "ρ : Gal(Q̄/Q) → GL₂(Z_p)",
                choices: [
                    { text: "A. Développer une méthode pour relever les représentations modulaires en caractéristique p", next: "deformation_theory" },
                    { text: "B. Utiliser les courbes de Shimura pour construire les représentations", next: "dead_end_4" },
                    { text: "C. Appliquer la théorie de Langlands directement", next: "dead_end_4" },
                    { text: "D. Chercher des isogénies entre courbes elliptiques", next: "dead_end_4" }
                ],
                progress: 55
            },

            deformation_theory: {
                title: "Chapitre 4 : La Théorie des Déformations",
                year: "1993 - Princeton",
                text: `Génial ! Vous développez une théorie des déformations des représentations galoisiennes. Cela permet de 'relever' les représentations de caractéristique p vers la caractéristique 0. Mais votre première tentative a une faille...`,
                formula: "R → T (anneau universel de déformation)",
                choices: [
                    { text: "A. Collaborer avec Richard Taylor pour combler la lacune avec la théorie d'Iwasawa", next: "taylor_collaboration" },
                    { text: "B. Chercher une approche différente via les courbes de Fermat généralisées", next: "dead_end_5" },
                    { text: "C. Utiliser les méthodes de Kolyvagin et les hauteurs d'Arakelov", next: "dead_end_5" },
                    { text: "D. Abandonner et essayer une approche complètement différente", next: "dead_end_5" }
                ],
                progress: 70
            },

            taylor_collaboration: {
                title: "Chapitre 5 : La Collaboration Décisive",
                year: "1994-1995 - Princeton",
                text: `Avec Richard Taylor, vous développez de nouveaux outils pour traiter les cas résiduels. En utilisant la théorie d'Iwasawa et une construction ingénieuse impliquant les courbes de Hecke, vous parvenez enfin à compléter la preuve !`,
                formula: "∀n>2, x^n + y^n ≠ z^n (x,y,z ∈ ℕ*)",
                choices: [
                    { text: "A. Annoncer la preuve complète du théorème de Fermat au monde mathématique", next: "victory" },
                    { text: "B. Garder la preuve secrète pour la vérifier encore", next: "dead_end_6" },
                    { text: "C. Publier seulement la partie sur Shimura-Taniyama", next: "dead_end_6" },
                    { text: "D. Demander à d'autres de vérifier d'abord", next: "dead_end_6" }
                ],
                progress: 85
            },

            victory: {
                title: "Épilogue : La Gloire Éternelle",
                year: "1995 - Cambridge, Angleterre",
                text: `Félicitations ! Vous avez réussi à suivre le chemin exact qu'Andrew Wiles a emprunté pour prouver le dernier théorème de Fermat. Votre preuve de 109 pages, utilisant les mathématiques les plus avancées du 20ème siècle, résout enfin le mystère vieux de 358 ans.<br><br>
                Le 23 juin 1993, lors d'une conférence à Cambridge, vous avez conclu votre présentation par ces mots historiques : "Je pense que je vais m'arrêter ici" avant de révéler la solution au monde ébahi.<br><br>
                Vous êtes devenu une légende vivante des mathématiques !`,
                formula: "Q.E.D. - Ce qu'il fallait démontrer",
                ending: "success",
                progress: 100
            },

            // Dead ends
            dead_end_1: {
                title: "Impasse : L'Approche Naïve",
                text: `Hélas ! Comme tant d'autres avant vous, vous vous heurtez à la complexité insurmontable du problème avec les méthodes élémentaires. Le théorème de Fermat résistera encore pendant des siècles à cette approche directe.`,
                ending: "failure",
                progress: 15
            },

            dead_end_2: {
                title: "Impasse : Les Méthodes Classiques",
                text: `Bien que ces approches soient sophistiquées, elles ne suffisent pas pour Fermat. Il faudra attendre les développements révolutionnaires de la fin du 20ème siècle pour trouver la voie.`,
                ending: "failure",
                progress: 30
            },

            dead_end_3: {
                title: "Impasse : L'Outil Inadéquat",
                text: `Ces méthodes, bien qu'importantes en théorie des nombres, ne peuvent pas établir le lien crucial entre courbes elliptiques et formes modulaires nécessaire pour Fermat.`,
                ending: "failure",
                progress: 45
            },

            dead_end_4: {
                title: "Impasse : La Voie Bloquée",
                text: `Vous êtes sur la bonne piste avec les représentations galoisiennes, mais cette approche particulière ne permet pas de construire le pont nécessaire vers les formes modulaires.`,
                ending: "failure",
                progress: 60
            },

            dead_end_5: {
                title: "Impasse : Si Proche du But",
                text: `Vous étiez très proche ! Mais sans la théorie des déformations adéquate et la collaboration avec Taylor, la lacune dans votre preuve demeure béante.`,
                ending: "failure",
                progress: 75
            },

            dead_end_6: {
                title: "Impasse : L'Occasion Manquée",
                text: `Ironie du sort ! Vous aviez la preuve complète, mais en ne l'annonçant pas au bon moment, l'histoire vous a oubliés. Il faut savoir saisir sa chance dans la science !`,
                ending: "failure",
                progress: 90
            }
        };

        let currentNode = 'start';

        // Fonction pour mélanger un tableau
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function displayNode(nodeId) {
            const node = story[nodeId];
            const content = document.getElementById('story-content');
            const progress = document.getElementById('progress');
            
            progress.style.width = node.progress + '%';
            
            if (node.ending) {
                // Fin du jeu
                content.innerHTML = `
                    <div class="chapter-header">
                        <h1>${node.title}</h1>
                        ${node.year ? `<div class="year">${node.year}</div>` : ''}
                    </div>
                    <div class="story-text">${node.text}</div>
                    ${node.formula ? `<div class="math-formula">${node.formula}</div>` : ''}
                    <div class="ending ${node.ending}">
                        <h2>${node.ending === 'success' ? '🎉 VICTOIRE ! 🎉' : '💥 ÉCHEC 💥'}</h2>
                        <p>${node.ending === 'success' ? 'Vous avez réussi à reconstituer la preuve historique !' : 'Ce chemin ne mène pas à la solution...'}</p>
                        <button class="restart-button" onclick="restart()">Recommencer l'aventure</button>
                    </div>
                `;
            } else {
                // Mélanger les choix aléatoirement
                const shuffledChoices = shuffleArray(node.choices);
                const letters = ['A', 'B', 'C', 'D'];
                
                // Nœud normal avec choix
                content.innerHTML = `
                    <div class="chapter-header">
                        <h1>${node.title}</h1>
                        ${node.year ? `<div class="year">${node.year}</div>` : ''}
                    </div>
                    <div class="story-text">${node.text}</div>
                    ${node.formula ? `<div class="math-formula">${node.formula}</div>` : ''}
                    <div class="choices">
                        ${shuffledChoices.map((choice, index) => {
                            // Remplacer la lettre originale par la nouvelle position
                            const newText = choice.text.replace(/^[A-D]\./, `${letters[index]}.`);
                            return `<button class="choice-button" onclick="makeChoice('${choice.next}')">${newText}</button>`;
                        }).join('')}
                    </div>
                `;
            }
        }

        function makeChoice(nextNode) {
            currentNode = nextNode;
            displayNode(currentNode);
        }

        function restart() {
            currentNode = 'start';
            displayNode(currentNode);
        }

        // Initialiser le jeu
        displayNode(currentNode);
    </script>
</body>
</html>
